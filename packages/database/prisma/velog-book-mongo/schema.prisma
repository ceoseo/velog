generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma/velog-book-mongo/client"
}

datasource db {
  provider = "mongodb"
  url      = env("VELOG_BOOK_MONGO_URL")
}

model Writer {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  fk_user_id       String   @unique
  pen_name         String   @unique
  email            String   @unique
  short_bio        String?  @db.String
  last_accessed_at DateTime @default(now()) @db.Timestamp
  books            Book[]

  @@map("writers")
}

model Book {
  id           String  @id @default(auto()) @map("_id") @db.ObjectId
  title        String  @db.String
  thumbnail    String  @db.String
  writer_id    String  @db.ObjectId
  is_published Boolean @default(false)
  is_private   Boolean @default(true)
  is_temp      Boolean @default(true)
  writer       Writer  @relation(fields: [writer_id], references: [id])
  pages        Page[]
  url_slug     String  @unique
  description  String  @db.String

  released_at DateTime? @db.Timestamp
  created_at  DateTime  @default(now()) @db.Timestamp
  updated_at  DateTime  @default(now()) @db.Timestamp

  @@map("books")
}

model Page {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  writer_id String  @db.ObjectId
  book_id   String  @db.ObjectId
  title     String  @db.String
  body      String  @db.String
  type      String  @db.String
  parent_id String? @db.String
  index     Int     @db.Int
  book      Book    @relation(fields: [book_id], references: [id])

  @@map("pages")
}

model PageHistory {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  writerId String @db.ObjectId
  pageId   String @db.String
  title    String @db.String
  body     String @db.String

  @@index([pageId])
  @@map("post_histories")
}
