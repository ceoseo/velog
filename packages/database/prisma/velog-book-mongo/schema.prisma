generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma/velog-book-mongo/client"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGO_URL")
}

model Writer {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  fk_user_id String @unique
  username   String @unique
  email      String @unique
  books      Book[]

  @@map("writers")
}

model Book {
  id           String  @id @default(auto()) @map("_id") @db.ObjectId
  title        String  @db.String
  thumbnail    String  @db.String
  writer_id    String  @db.ObjectId
  is_published Boolean @default(false)
  writer       Writer  @relation(fields: [writer_id], references: [id])
  pages        Page[]

  @@map("books")
}

model Page {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  writer_id String  @db.ObjectId
  book_id   String  @db.ObjectId
  title     String  @db.String
  body      String  @db.String
  type      String  @db.String
  parent_id String? @db.String
  index     Int     @db.Int
  book      Book    @relation(fields: [book_id], references: [id])

  @@map("pages")
}

model PageHistory {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  writerId String @db.ObjectId
  pageId   String @db.String
  title    String @db.String
  body     String @db.String

  @@index([pageId])
  @@map("post_histories")
}
